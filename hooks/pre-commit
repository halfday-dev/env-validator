#!/usr/bin/env bash
# halfday-env-scan pre-commit hook
# Scans staged .env* files and blocks commit if grade is D-F

set -euo pipefail

# Find staged .env* files
ENV_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.env' || true)

if [ -z "$ENV_FILES" ]; then
  exit 0
fi

FAILED=0

for f in $ENV_FILES; do
  echo "üîí Scanning $f..."
  if ! npx halfday-env-scan --quiet "$f"; then
    echo "‚ùå $f failed security scan (grade D-F)"
    FAILED=1
  fi
done

if [ "$FAILED" -ne 0 ]; then
  echo ""
  echo "Commit blocked: one or more .env files failed security scanning."
  echo "Run 'npx halfday-env-scan <file>' for details."
  exit 1
fi
