---
import Layout from '../../layouts/Layout.astro';
---
<Layout title="ENV Validator & Security Scanner ‚Äî Halfday">
  <!-- Header -->
  <header class="border-b border-gray-800 px-4 py-4">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <a href="https://halfday.dev" class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-lg bg-emerald-500 flex items-center justify-center font-bold text-white text-sm">H</div>
        <div>
          <span class="font-semibold text-lg">Halfday</span>
          <span class="text-gray-500 text-xs ml-2 hidden sm:inline">tools built in half a day</span>
        </div>
      </a>
      <a href="https://halfday.dev/tools" class="text-sm text-gray-400 hover:text-emerald-400 transition">‚Üê All Tools</a>
    </div>
  </header>

  <main class="flex-1 px-4 py-8 max-w-5xl mx-auto w-full">
    <!-- Trust Banner -->
    <div class="mb-6 flex items-center gap-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg px-4 py-3 text-emerald-400 text-sm">
      <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
      <span><strong>Your secrets never leave your browser.</strong> All analysis runs 100% client-side. No data is sent to any server.</span>
    </div>

    <h1 class="text-3xl font-bold mb-2">.env Validator & Security Scanner</h1>
    <p class="text-gray-400 mb-6">Paste your .env file to detect leaked API keys, weak passwords, and common misconfigurations.</p>

    <!-- Input -->
    <div class="mb-4 flex items-center gap-2">
      <button id="sampleBtn" class="text-sm px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 text-gray-300 transition">Load Sample</button>
      <button id="clearBtn" class="text-sm px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 text-gray-300 transition">Clear</button>
    </div>
    <textarea id="envInput" class="w-full h-64 bg-gray-900 border border-gray-700 rounded-lg p-4 font-mono text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-y placeholder-gray-600" placeholder="Paste your .env file here..."></textarea>

    <!-- Results -->
    <div id="results" class="mt-8 hidden">
      <!-- Score -->
      <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <div id="scoreCard" class="flex-shrink-0 w-full sm:w-48 rounded-lg border border-gray-800 bg-gray-900 p-6 flex flex-col items-center justify-center">
          <div class="text-xs uppercase tracking-wider text-gray-500 mb-1">Security Score</div>
          <div id="scoreGrade" class="text-6xl font-black"></div>
          <div id="scoreLabel" class="text-sm mt-1"></div>
        </div>
        <div class="flex-1 grid grid-cols-3 gap-3">
          <div class="rounded-lg bg-gray-900 border border-gray-800 p-4 text-center">
            <div id="critCount" class="text-2xl font-bold text-red-400">0</div>
            <div class="text-xs text-gray-500 mt-1">Critical</div>
          </div>
          <div class="rounded-lg bg-gray-900 border border-gray-800 p-4 text-center">
            <div id="warnCount" class="text-2xl font-bold text-yellow-400">0</div>
            <div class="text-xs text-gray-500 mt-1">Warnings</div>
          </div>
          <div class="rounded-lg bg-gray-900 border border-gray-800 p-4 text-center">
            <div id="infoCount" class="text-2xl font-bold text-blue-400">0</div>
            <div class="text-xs text-gray-500 mt-1">Info</div>
          </div>
        </div>
      </div>

      <!-- Findings -->
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Findings</h2>
        <button id="copyBtn" class="text-sm px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 text-gray-300 transition flex items-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          Copy Results
        </button>
      </div>
      <div id="findingsList" class="space-y-2"></div>

      <!-- Gitignore suggestion -->
      <div id="gitignoreSection" class="mt-8 hidden">
        <h2 class="text-lg font-semibold mb-3">Suggested .gitignore entries</h2>
        <pre id="gitignoreSuggest" class="bg-gray-900 border border-gray-800 rounded-lg p-4 font-mono text-sm text-gray-300 overflow-x-auto"></pre>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-800 px-4 py-6 text-center text-gray-500 text-sm">
    <p>Built by <a href="https://halfday.dev" class="text-emerald-400 hover:underline">Halfday</a> ¬∑ <a href="https://github.com/halfday-dev" class="text-gray-400 hover:text-emerald-400 transition">GitHub</a></p>
  </footer>

  <script>
    // ‚îÄ‚îÄ‚îÄ API Key Patterns (50+) ‚îÄ‚îÄ‚îÄ
    const patterns = [
      { name: 'AWS Access Key ID', regex: /(?:^|['"= ])?(AKIA[0-9A-Z]{16})(?:['"\s]|$)/, severity: 'critical', desc: 'AWS access key detected', fix: 'Rotate this key immediately in AWS IAM console and use environment-specific credentials.' },
      { name: 'AWS Secret Access Key', regex: /(?:aws_secret_access_key|aws_secret)\s*=\s*['"]?([A-Za-z0-9/+=]{40})['"]?/, severity: 'critical', desc: 'AWS secret key detected', fix: 'Rotate in AWS IAM. Use IAM roles or AWS Secrets Manager instead.' },
      { name: 'Stripe Secret Key', regex: /sk_live_[0-9a-zA-Z]{24,}/, severity: 'critical', desc: 'Stripe live secret key detected', fix: 'Rotate in Stripe Dashboard ‚Üí API Keys. Use restricted keys with minimal permissions.' },
      { name: 'Stripe Publishable Key', regex: /pk_live_[0-9a-zA-Z]{24,}/, severity: 'info', desc: 'Stripe publishable key (safe for client-side, but keep out of repos)', fix: 'Publishable keys are designed for client use but should still be in env vars.' },
      { name: 'GitHub Personal Access Token', regex: /ghp_[0-9a-zA-Z]{36}/, severity: 'critical', desc: 'GitHub PAT detected', fix: 'Revoke at GitHub Settings ‚Üí Developer Settings ‚Üí Personal Access Tokens.' },
      { name: 'GitHub OAuth Token', regex: /gho_[0-9a-zA-Z]{36}/, severity: 'critical', desc: 'GitHub OAuth token detected', fix: 'Revoke at GitHub Settings ‚Üí Applications.' },
      { name: 'GitHub App Token', regex: /(?:ghu|ghs)_[0-9a-zA-Z]{36}/, severity: 'critical', desc: 'GitHub App token detected', fix: 'Rotate via your GitHub App settings.' },
      { name: 'GitHub Fine-grained PAT', regex: /github_pat_[0-9a-zA-Z_]{82}/, severity: 'critical', desc: 'GitHub fine-grained PAT detected', fix: 'Revoke at GitHub Settings ‚Üí Developer Settings.' },
      { name: 'OpenAI API Key', regex: /sk-[0-9a-zA-Z]{20}T3BlbkFJ[0-9a-zA-Z]{20}/, severity: 'critical', desc: 'OpenAI API key detected', fix: 'Rotate at platform.openai.com/api-keys. Set usage limits.' },
      { name: 'OpenAI API Key (new format)', regex: /sk-proj-[0-9a-zA-Z_-]{40,}/, severity: 'critical', desc: 'OpenAI project API key detected', fix: 'Rotate at platform.openai.com/api-keys.' },
      { name: 'Google API Key', regex: /AIza[0-9A-Za-z_-]{35}/, severity: 'critical', desc: 'Google API key detected', fix: 'Restrict key in Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials.' },
      { name: 'Google OAuth Client Secret', regex: /GOCSPX-[0-9A-Za-z_-]{28}/, severity: 'critical', desc: 'Google OAuth client secret detected', fix: 'Rotate in Google Cloud Console ‚Üí OAuth 2.0 Client IDs.' },
      { name: 'Slack Bot Token', regex: /xoxb-[0-9]{10,13}-[0-9]{10,13}-[0-9a-zA-Z]{24}/, severity: 'critical', desc: 'Slack bot token detected', fix: 'Rotate at api.slack.com ‚Üí Your Apps ‚Üí OAuth & Permissions.' },
      { name: 'Slack User Token', regex: /xoxp-[0-9]{10,13}-[0-9]{10,13}-[0-9a-zA-Z]{24,}/, severity: 'critical', desc: 'Slack user token detected', fix: 'Rotate at api.slack.com ‚Üí Your Apps ‚Üí OAuth & Permissions.' },
      { name: 'Slack Webhook URL', regex: /hooks\.slack\.com\/services\/T[0-9A-Z]{8,}\/B[0-9A-Z]{8,}\/[0-9a-zA-Z]{24}/, severity: 'warning', desc: 'Slack webhook URL detected', fix: 'Rotate the webhook in your Slack app settings.' },
      { name: 'Twilio Account SID', regex: /AC[0-9a-f]{32}/, severity: 'warning', desc: 'Twilio Account SID detected', fix: 'SIDs are semi-public but should still be in env vars.' },
      { name: 'Twilio Auth Token', regex: /(?:twilio.*auth.*token|TWILIO_AUTH_TOKEN)\s*=\s*['"]?([0-9a-f]{32})['"]?/i, severity: 'critical', desc: 'Twilio auth token detected', fix: 'Rotate in Twilio Console ‚Üí Account ‚Üí API Keys.' },
      { name: 'SendGrid API Key', regex: /SG\.[0-9A-Za-z_-]{22}\.[0-9A-Za-z_-]{43}/, severity: 'critical', desc: 'SendGrid API key detected', fix: 'Rotate at app.sendgrid.com ‚Üí Settings ‚Üí API Keys.' },
      { name: 'Mailgun API Key', regex: /key-[0-9a-zA-Z]{32}/, severity: 'critical', desc: 'Mailgun API key detected', fix: 'Rotate in Mailgun Dashboard ‚Üí API Security.' },
      { name: 'Datadog API Key', regex: /(?:datadog|dd)[\w_]*(?:api)?[\w_]*key\s*=\s*['"]?([0-9a-f]{32})['"]?/i, severity: 'critical', desc: 'Datadog API key detected', fix: 'Rotate in Datadog ‚Üí Organization Settings ‚Üí API Keys.' },
      { name: 'New Relic API Key', regex: /NRAK-[0-9A-Z]{27}/, severity: 'critical', desc: 'New Relic API key detected', fix: 'Rotate at one.newrelic.com ‚Üí API Keys.' },
      { name: 'New Relic License Key', regex: /[0-9a-f]{36}NRAL/, severity: 'critical', desc: 'New Relic license key detected', fix: 'Rotate in New Relic account settings.' },
      { name: 'PagerDuty API Key', regex: /(?:pagerduty|pd)[\w_]*key\s*=\s*['"]?([0-9a-zA-Z+/=]{20,})['"]?/i, severity: 'critical', desc: 'PagerDuty key detected', fix: 'Rotate at PagerDuty ‚Üí API Access Keys.' },
      { name: 'Sentry DSN', regex: /https:\/\/[0-9a-f]{32}@(?:o\d+\.)?(?:sentry\.io|[^/]+)\/\d+/, severity: 'warning', desc: 'Sentry DSN detected (contains project info)', fix: 'DSNs are semi-public for client SDKs but should not be committed.' },
      { name: 'Firebase API Key', regex: /(?:firebase|FIREBASE)[\w_]*(?:api)?[\w_]*key\s*=\s*['"]?(AIza[0-9A-Za-z_-]{35})['"]?/i, severity: 'warning', desc: 'Firebase API key detected', fix: 'Restrict via Firebase Console ‚Üí Project Settings ‚Üí API restrictions.' },
      { name: 'Supabase Service Role Key', regex: /eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.[A-Za-z0-9_-]{50,}\.[A-Za-z0-9_-]{20,}/, severity: 'critical', desc: 'Supabase/JWT service key detected', fix: 'Rotate in Supabase Dashboard ‚Üí Settings ‚Üí API.' },
      { name: 'Cloudflare API Token', regex: /(?:cloudflare|cf)[\w_]*(?:api)?[\w_]*token\s*=\s*['"]?([0-9a-zA-Z_-]{40})['"]?/i, severity: 'critical', desc: 'Cloudflare API token detected', fix: 'Rotate at Cloudflare Dashboard ‚Üí My Profile ‚Üí API Tokens.' },
      { name: 'Cloudflare Global API Key', regex: /(?:cloudflare|cf)[\w_]*(?:global)?[\w_]*key\s*=\s*['"]?([0-9a-f]{37})['"]?/i, severity: 'critical', desc: 'Cloudflare Global API key detected', fix: 'Use scoped API tokens instead. Rotate in Cloudflare profile.' },
      { name: 'DigitalOcean Token', regex: /dop_v1_[0-9a-f]{64}/, severity: 'critical', desc: 'DigitalOcean personal access token detected', fix: 'Revoke at cloud.digitalocean.com ‚Üí API ‚Üí Tokens.' },
      { name: 'DigitalOcean OAuth', regex: /doo_v1_[0-9a-f]{64}/, severity: 'critical', desc: 'DigitalOcean OAuth token detected', fix: 'Revoke at cloud.digitalocean.com ‚Üí API.' },
      { name: 'Heroku API Key', regex: /(?:heroku[\w_]*(?:api)?[\w_]*key)\s*=\s*['"]?([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})['"]?/i, severity: 'critical', desc: 'Heroku API key detected', fix: 'Regenerate at Heroku Dashboard ‚Üí Account ‚Üí API Key.' },
      { name: 'Vercel Token', regex: /(?:vercel[\w_]*token)\s*=\s*['"]?([0-9a-zA-Z]{24,})['"]?/i, severity: 'critical', desc: 'Vercel token detected', fix: 'Rotate at vercel.com ‚Üí Settings ‚Üí Tokens.' },
      { name: 'Netlify Token', regex: /(?:netlify[\w_]*token)\s*=\s*['"]?([0-9a-zA-Z_-]{40,})['"]?/i, severity: 'critical', desc: 'Netlify token detected', fix: 'Rotate at app.netlify.com ‚Üí User Settings ‚Üí Applications.' },
      { name: 'npm Token', regex: /npm_[0-9a-zA-Z]{36}/, severity: 'critical', desc: 'npm access token detected', fix: 'Revoke at npmjs.com ‚Üí Access Tokens. Use granular tokens.' },
      { name: 'PyPI Token', regex: /pypi-[0-9a-zA-Z_-]{50,}/, severity: 'critical', desc: 'PyPI API token detected', fix: 'Revoke at pypi.org ‚Üí Account Settings ‚Üí API Tokens.' },
      { name: 'Docker Hub Token', regex: /dckr_pat_[0-9a-zA-Z_-]{20,}/, severity: 'critical', desc: 'Docker Hub personal access token detected', fix: 'Revoke at hub.docker.com ‚Üí Account Settings ‚Üí Security.' },
      { name: 'CircleCI Token', regex: /(?:circleci|circle)[\w_]*token\s*=\s*['"]?([0-9a-f]{40})['"]?/i, severity: 'critical', desc: 'CircleCI token detected', fix: 'Rotate at circleci.com ‚Üí User Settings ‚Üí Personal API Tokens.' },
      { name: 'Travis CI Token', regex: /(?:travis[\w_]*token)\s*=\s*['"]?([0-9a-zA-Z]{22,})['"]?/i, severity: 'critical', desc: 'Travis CI token detected', fix: 'Rotate in Travis CI account settings.' },
      { name: 'GitLab Token', regex: /glpat-[0-9a-zA-Z_-]{20}/, severity: 'critical', desc: 'GitLab personal access token detected', fix: 'Revoke at GitLab ‚Üí User Settings ‚Üí Access Tokens.' },
      { name: 'GitLab Pipeline Token', regex: /glptt-[0-9a-f]{40}/, severity: 'critical', desc: 'GitLab pipeline trigger token detected', fix: 'Revoke in GitLab ‚Üí CI/CD ‚Üí Pipeline triggers.' },
      { name: 'Bitbucket App Password', regex: /(?:bitbucket[\w_]*(?:app)?[\w_]*(?:pass|pw))\s*=\s*['"]?([0-9a-zA-Z]{18,})['"]?/i, severity: 'critical', desc: 'Bitbucket app password detected', fix: 'Revoke at Bitbucket ‚Üí Personal Settings ‚Üí App Passwords.' },
      { name: 'Azure Storage Key', regex: /(?:DefaultEndpointsProtocol=https;AccountName=)[^;]+;AccountKey=[A-Za-z0-9+/=]{86,88};/, severity: 'critical', desc: 'Azure Storage connection string detected', fix: 'Rotate in Azure Portal ‚Üí Storage Account ‚Üí Access Keys.' },
      { name: 'Azure Client Secret', regex: /(?:azure[\w_]*(?:client)?[\w_]*secret)\s*=\s*['"]?([0-9a-zA-Z~._-]{34,})['"]?/i, severity: 'critical', desc: 'Azure client secret detected', fix: 'Rotate in Azure AD ‚Üí App Registrations ‚Üí Certificates & Secrets.' },
      { name: 'GCP Service Account Key', regex: /"private_key":\s*"-----BEGIN (?:RSA )?PRIVATE KEY-----/, severity: 'critical', desc: 'GCP service account private key detected', fix: 'Delete and recreate at GCP Console ‚Üí IAM ‚Üí Service Accounts ‚Üí Keys.' },
      { name: 'GCP API Key', regex: /(?:gcp|google_cloud)[\w_]*(?:api)?[\w_]*key\s*=\s*['"]?(AIza[0-9A-Za-z_-]{35})['"]?/i, severity: 'critical', desc: 'GCP API key detected', fix: 'Restrict in GCP Console ‚Üí APIs & Services ‚Üí Credentials.' },
      { name: 'Private Key (PEM)', regex: /-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----/, severity: 'critical', desc: 'Private key detected in env file', fix: 'Never store private keys in .env files. Use a secrets manager or key vault.' },
      { name: 'JWT Secret', regex: /(?:jwt[\w_]*secret|secret[\w_]*key)\s*=\s*['"]?([^\s'"]{8,})['"]?/i, severity: 'warning', desc: 'JWT secret or signing key detected', fix: 'Use a strong, random secret (256+ bits). Store in a secrets manager.' },
      { name: 'Database URL with Password', regex: /(?:postgres(?:ql)?|mysql|mariadb|mssql):\/\/[^:]+:[^@\s]+@[^\s]+/, severity: 'critical', desc: 'Database connection string with embedded password', fix: 'Use separate DB_HOST/DB_PASSWORD vars or a secrets manager.' },
      { name: 'Redis URL with Password', regex: /rediss?:\/\/[^:]*:[^@\s]+@[^\s]+/, severity: 'critical', desc: 'Redis URL with embedded password', fix: 'Use separate REDIS_HOST/REDIS_PASSWORD environment variables.' },
      { name: 'MongoDB URI with Password', regex: /mongodb(?:\+srv)?:\/\/[^:]+:[^@\s]+@[^\s]+/, severity: 'critical', desc: 'MongoDB connection string with embedded password', fix: 'Use MongoDB Atlas secrets or separate DB credential vars.' },
      { name: 'Shopify Access Token', regex: /shpat_[0-9a-fA-F]{32}/, severity: 'critical', desc: 'Shopify admin access token detected', fix: 'Rotate in Shopify Admin ‚Üí Apps ‚Üí Develop apps.' },
      { name: 'Shopify Shared Secret', regex: /shpss_[0-9a-fA-F]{32}/, severity: 'critical', desc: 'Shopify shared secret detected', fix: 'Rotate in Shopify Partner Dashboard.' },
      { name: 'Discord Bot Token', regex: /[MN][A-Za-z\d]{23,}\.[\w-]{6}\.[\w-]{27,}/, severity: 'critical', desc: 'Discord bot token detected', fix: 'Regenerate at discord.com/developers ‚Üí Bot ‚Üí Reset Token.' },
      { name: 'Telegram Bot Token', regex: /\d{8,10}:[0-9A-Za-z_-]{35}/, severity: 'critical', desc: 'Telegram bot token detected', fix: 'Revoke via @BotFather on Telegram.' },
      { name: 'Anthropic API Key', regex: /sk-ant-api\d{2}-[0-9a-zA-Z_-]{90,}/, severity: 'critical', desc: 'Anthropic API key detected', fix: 'Rotate at console.anthropic.com ‚Üí API Keys.' },
      { name: 'Hugging Face Token', regex: /hf_[0-9a-zA-Z]{34}/, severity: 'critical', desc: 'Hugging Face access token detected', fix: 'Rotate at huggingface.co ‚Üí Settings ‚Üí Access Tokens.' },
      { name: 'Mapbox Token', regex: /(?:pk|sk)\.eyJ[0-9a-zA-Z_-]+\.[0-9a-zA-Z_-]{20,}/, severity: 'warning', desc: 'Mapbox access token detected', fix: 'Rotate at mapbox.com ‚Üí Account ‚Üí Tokens. Restrict token scopes.' },
      { name: 'Algolia API Key', regex: /(?:algolia[\w_]*(?:api)?[\w_]*key)\s*=\s*['"]?([0-9a-f]{32})['"]?/i, severity: 'warning', desc: 'Algolia API key detected', fix: 'Use search-only keys for client-side. Rotate admin keys in Algolia Dashboard.' },
      { name: 'Mixpanel Token', regex: /(?:mixpanel[\w_]*token)\s*=\s*['"]?([0-9a-f]{32})['"]?/i, severity: 'warning', desc: 'Mixpanel project token detected', fix: 'Tokens are semi-public but should not be committed.' },
      { name: 'Segment Write Key', regex: /(?:segment[\w_]*(?:write)?[\w_]*key)\s*=\s*['"]?([0-9a-zA-Z]{22,})['"]?/i, severity: 'warning', desc: 'Segment write key detected', fix: 'Rotate in Segment ‚Üí Workspace ‚Üí Sources ‚Üí Settings.' },
      { name: 'Linear API Key', regex: /lin_api_[0-9a-zA-Z]{40}/, severity: 'critical', desc: 'Linear API key detected', fix: 'Revoke at linear.app ‚Üí Settings ‚Üí API.' },
      { name: 'Livekit API Key/Secret', regex: /(?:livekit[\w_]*(?:api)?[\w_]*(?:key|secret))\s*=\s*['"]?([0-9a-zA-Z]{20,})['"]?/i, severity: 'critical', desc: 'LiveKit credential detected', fix: 'Rotate in your LiveKit Cloud dashboard.' },
      { name: 'Postmark Server Token', regex: /(?:postmark[\w_]*(?:server)?[\w_]*token)\s*=\s*['"]?([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})['"]?/i, severity: 'critical', desc: 'Postmark server token detected', fix: 'Rotate in Postmark ‚Üí Servers ‚Üí API Tokens.' },
      { name: 'Resend API Key', regex: /re_[0-9a-zA-Z]{20,}/, severity: 'critical', desc: 'Resend API key detected', fix: 'Rotate at resend.com ‚Üí API Keys.' },
      { name: 'Planetscale Password', regex: /pscale_pw_[0-9a-zA-Z_-]{40,}/, severity: 'critical', desc: 'PlanetScale database password detected', fix: 'Rotate in PlanetScale Dashboard ‚Üí Database ‚Üí Passwords.' },
      { name: 'Turso Database Token', regex: /(?:turso|libsql)[\w_]*(?:auth)?[\w_]*token\s*=\s*['"]?(eyJ[0-9a-zA-Z_-]+\.[0-9a-zA-Z_-]+\.[0-9a-zA-Z_-]+)['"]?/i, severity: 'critical', desc: 'Turso/LibSQL auth token detected', fix: 'Rotate via turso CLI: turso db tokens invalidate.' },
      { name: 'Clerk Secret Key', regex: /sk_live_[0-9a-zA-Z]{20,}/, severity: 'critical', desc: 'Clerk secret key detected', fix: 'Rotate in Clerk Dashboard ‚Üí API Keys.' },
      { name: 'Generic Secret in Value', regex: /(?:secret|password|passwd|token|apikey|api_key|auth_token|access_token)[\w]*\s*=\s*['"]?([^\s'"]{8,})['"]?/i, severity: 'warning', desc: 'Potential secret value detected', fix: 'Review this value and ensure it is not committed to version control.' },
    ];

    const weakPasswords = ['password', 'password1', 'password123', '123456', '12345678', '123456789', '1234567890', 'admin', 'admin123', 'root', 'root123', 'test', 'test123', 'changeme', 'changeit', 'default', 'secret', 'letmein', 'welcome', 'qwerty', 'abc123', 'monkey', 'master', 'dragon', 'login', 'princess', 'football', 'shadow', 'sunshine', 'trustno1', 'iloveyou', 'batman', 'passw0rd', 'hello', 'charlie', 'donald', 'p@ssw0rd', 'P@ssw0rd', 'P@ssword1', 'supersecret', 'hunter2', 'letmein123'];

    const sampleEnv = `# Database
DATABASE_URL=postgres://admin:password123@localhost:5432/myapp
REDIS_URL=redis://:supersecret@cache.example.com:6379

# AWS
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1

# Stripe
STRIPE_SECRET_KEY=sk_live_51HG8eXAMPLEKEYabc123def456
STRIPE_PUBLISHABLE_KEY=pk_live_51HG8eXAMPLEKEYxyz789

# OpenAI
OPENAI_API_KEY=sk-proj-abc123def456ghi789jkl012mno345pqr678stu901vwx

# GitHub
GITHUB_TOKEN=ghp_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh

# Slack
SLACK_BOT_TOKEN=xoxb-1234567890-1234567890123-ABCDEFGHIJKLMNOPQRSTUVw

# SendGrid
SENDGRID_API_KEY=SG.abcdefghijklmnopqrstuv.ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopq

# App Config
APP_NAME=My Cool App
DEBUG=true
PORT=3000
NODE_ENV=development
API_URL=https://api.example.com
JWT_SECRET=changeme

# Duplicate key
DEBUG=false

# Empty values
EMPTY_VAR=
ANOTHER_EMPTY=

# Unquoted value with spaces
APP_DESCRIPTION=My awesome app with spaces

# Commented out secret
# OLD_API_KEY=sk_live_oldkey123456789012345678
# PREVIOUS_DB_PASSWORD=oldpassword123

# npm
NPM_TOKEN=npm_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh

# GitLab
GITLAB_TOKEN=glpat-ABCDEFGHIJKLMNOPabcd

# Private key (BAD!)
PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\\nMIIEpA..."
`;

    function analyze(text) {
      if (!text.trim()) return null;
      const lines = text.split('\n');
      const findings = [];
      const keys = {};
      let lineNum = 0;

      for (const line of lines) {
        lineNum++;
        const trimmed = line.trim();

        // Skip empty lines
        if (!trimmed) continue;

        // Check commented-out secrets
        if (trimmed.startsWith('#')) {
          const uncommented = trimmed.slice(1).trim();
          for (const p of patterns) {
            if (p.regex.test(uncommented)) {
              findings.push({ line: lineNum, severity: 'warning', name: `Commented-out ${p.name}`, desc: `Commented line still contains a ${p.name.toLowerCase()}. Remove it entirely.`, fix: 'Delete commented-out secrets completely rather than just commenting them.' });
              break;
            }
          }
          continue;
        }

        // Parse KEY=VALUE
        const match = trimmed.match(/^([^=]+?)=(.*)$/);
        if (!match) continue;
        const [, key, value] = match;
        const cleanKey = key.trim();
        const cleanVal = value.trim();

        // Invalid key characters
        if (!/^[A-Za-z_][A-Za-z0-9_]*$/.test(cleanKey)) {
          findings.push({ line: lineNum, severity: 'warning', name: 'Invalid key name', desc: `"${cleanKey}" contains invalid characters. Keys should be alphanumeric with underscores.`, fix: 'Use only A-Z, 0-9, and underscore. Start with a letter or underscore.' });
        }

        // Duplicate key
        if (keys[cleanKey]) {
          findings.push({ line: lineNum, severity: 'warning', name: 'Duplicate key', desc: `"${cleanKey}" is defined on lines ${keys[cleanKey]} and ${lineNum}. The last value wins.`, fix: 'Remove the duplicate definition to avoid confusion.' });
        }
        keys[cleanKey] = lineNum;

        // Empty value
        if (cleanVal === '') {
          findings.push({ line: lineNum, severity: 'info', name: 'Empty value', desc: `"${cleanKey}" has an empty value.`, fix: 'Set a value or remove the variable if unused.' });
          continue;
        }

        // Unquoted value with spaces
        if (cleanVal.includes(' ') && !cleanVal.startsWith('"') && !cleanVal.startsWith("'")) {
          findings.push({ line: lineNum, severity: 'warning', name: 'Unquoted value with spaces', desc: `"${cleanKey}" contains spaces but is not quoted. Some parsers may truncate at the first space.`, fix: 'Wrap the value in double quotes: KEY="value with spaces"' });
        }

        // Values with quotes needing escaping
        if ((cleanVal.startsWith('"') && cleanVal.includes('\\"') === false && (cleanVal.match(/"/g) || []).length % 2 !== 0) ||
            (cleanVal.startsWith("'") && (cleanVal.match(/'/g) || []).length % 2 !== 0)) {
          findings.push({ line: lineNum, severity: 'warning', name: 'Mismatched quotes', desc: `"${cleanKey}" has mismatched quotes.`, fix: 'Ensure opening and closing quotes match.' });
        }

        // Weak passwords
        const lowerVal = cleanVal.replace(/^['"]|['"]$/g, '').toLowerCase();
        if (/(?:password|passwd|pass|secret|key|token)/i.test(cleanKey) && weakPasswords.includes(lowerVal)) {
          findings.push({ line: lineNum, severity: 'critical', name: 'Weak/default password', desc: `"${cleanKey}" uses a common weak password: "${lowerVal}".`, fix: 'Use a strong, randomly generated password (32+ characters, mixed case, numbers, symbols).' });
        }

        // API key patterns
        for (const p of patterns) {
          if (p.regex.test(trimmed)) {
            findings.push({ line: lineNum, severity: p.severity, name: p.name, desc: p.desc, fix: p.fix });
          }
        }
      }

      return findings;
    }

    function computeScore(findings) {
      const crits = findings.filter(f => f.severity === 'critical').length;
      const warns = findings.filter(f => f.severity === 'warning').length;
      const score = Math.max(0, 100 - crits * 15 - warns * 5);
      if (score >= 90) return { grade: 'A', label: 'Excellent', color: 'text-emerald-400', bg: 'border-emerald-500/30' };
      if (score >= 75) return { grade: 'B', label: 'Good', color: 'text-green-400', bg: 'border-green-500/30' };
      if (score >= 60) return { grade: 'C', label: 'Fair', color: 'text-yellow-400', bg: 'border-yellow-500/30' };
      if (score >= 40) return { grade: 'D', label: 'Poor', color: 'text-orange-400', bg: 'border-orange-500/30' };
      return { grade: 'F', label: 'Critical', color: 'text-red-400', bg: 'border-red-500/30' };
    }

    const severityConfig = {
      critical: { bg: 'bg-red-500/10', border: 'border-red-500/20', badge: 'bg-red-500/20 text-red-400', icon: 'üî¥' },
      warning: { bg: 'bg-yellow-500/10', border: 'border-yellow-500/20', badge: 'bg-yellow-500/20 text-yellow-400', icon: 'üü°' },
      info: { bg: 'bg-blue-500/10', border: 'border-blue-500/20', badge: 'bg-blue-500/20 text-blue-400', icon: 'üîµ' },
    };

    function render(findings) {
      const results = document.getElementById('results');
      const list = document.getElementById('findingsList');
      if (!findings || findings.length === 0) {
        if (document.getElementById('envInput').value.trim()) {
          results.classList.remove('hidden');
          document.getElementById('scoreGrade').textContent = 'A';
          document.getElementById('scoreGrade').className = 'text-6xl font-black text-emerald-400';
          document.getElementById('scoreLabel').textContent = 'No issues found!';
          document.getElementById('scoreLabel').className = 'text-sm mt-1 text-emerald-400';
          document.getElementById('scoreCard').className = 'flex-shrink-0 w-full sm:w-48 rounded-lg border border-emerald-500/30 bg-gray-900 p-6 flex flex-col items-center justify-center';
          document.getElementById('critCount').textContent = '0';
          document.getElementById('warnCount').textContent = '0';
          document.getElementById('infoCount').textContent = '0';
          list.innerHTML = '<p class="text-gray-500 text-sm">‚úÖ No issues detected. Your .env file looks clean!</p>';
          document.getElementById('gitignoreSection').classList.remove('hidden');
        } else {
          results.classList.add('hidden');
        }
        return;
      }

      results.classList.remove('hidden');
      const score = computeScore(findings);
      document.getElementById('scoreGrade').textContent = score.grade;
      document.getElementById('scoreGrade').className = `text-6xl font-black ${score.color}`;
      document.getElementById('scoreLabel').textContent = score.label;
      document.getElementById('scoreLabel').className = `text-sm mt-1 ${score.color}`;
      document.getElementById('scoreCard').className = `flex-shrink-0 w-full sm:w-48 rounded-lg border ${score.bg} bg-gray-900 p-6 flex flex-col items-center justify-center`;

      const crits = findings.filter(f => f.severity === 'critical');
      const warns = findings.filter(f => f.severity === 'warning');
      const infos = findings.filter(f => f.severity === 'info');
      document.getElementById('critCount').textContent = crits.length;
      document.getElementById('warnCount').textContent = warns.length;
      document.getElementById('infoCount').textContent = infos.length;

      list.innerHTML = [...crits, ...warns, ...infos].map(f => {
        const c = severityConfig[f.severity];
        return `<div class="rounded-lg ${c.bg} border ${c.border} p-4">
          <div class="flex items-start gap-3">
            <span class="text-sm mt-0.5">${c.icon}</span>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-sm font-medium text-gray-200">${f.name}</span>
                <span class="text-xs px-2 py-0.5 rounded-full ${c.badge}">${f.severity}</span>
                <span class="text-xs text-gray-500">Line ${f.line}</span>
              </div>
              <p class="text-sm text-gray-400 mt-1">${f.desc}</p>
              <p class="text-xs text-gray-500 mt-1">üí° ${f.fix}</p>
            </div>
          </div>
        </div>`;
      }).join('');

      document.getElementById('gitignoreSection').classList.remove('hidden');
    }

    // Gitignore suggestions
    document.getElementById('gitignoreSuggest').textContent = `.env
.env.local
.env.production
.env.*.local
.env.development.local
.env.test.local
.env.production.local`;

    // Event listeners
    const input = document.getElementById('envInput');
    let debounce;
    input.addEventListener('input', () => {
      clearTimeout(debounce);
      debounce = setTimeout(() => render(analyze(input.value)), 150);
    });

    document.getElementById('sampleBtn').addEventListener('click', () => {
      input.value = sampleEnv;
      render(analyze(sampleEnv));
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      input.value = '';
      document.getElementById('results').classList.add('hidden');
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const findings = analyze(input.value);
      if (!findings) return;
      const score = computeScore(findings);
      const text = `ENV Validator Report ‚Äî Score: ${score.grade} (${score.label})\n` +
        `Critical: ${findings.filter(f=>f.severity==='critical').length} | Warnings: ${findings.filter(f=>f.severity==='warning').length} | Info: ${findings.filter(f=>f.severity==='info').length}\n\n` +
        findings.map(f => `[${f.severity.toUpperCase()}] Line ${f.line}: ${f.name} ‚Äî ${f.desc}`).join('\n') +
        '\n\nScanned with halfday.dev/tools/env-validator';
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
        setTimeout(() => {
          btn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg> Copy Results';
        }, 2000);
      });
    });
  </script>
</Layout>
